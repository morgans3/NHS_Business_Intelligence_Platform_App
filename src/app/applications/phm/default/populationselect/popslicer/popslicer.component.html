<div>
    <div fxLayout="row wrap">
        <div fxFlex.gt-sm="25" fxFlex.gt-xs="100" fxFlex="100">
            <app-statcard [data]="icpPopulation"></app-statcard>
        </div>
        <div fxFlex.gt-sm="25" fxFlex.gt-xs="100" fxFlex="100">
            <app-statcard [data]="customPopulation"></app-statcard>
        </div>
        <div fxFlex.gt-sm="25" fxFlex.gt-xs="100" fxFlex="100">
            <app-statcard [data]="selectedPop"></app-statcard>
        </div>
        <div fxFlex.gt-sm="25" fxFlex.gt-xs="100" fxFlex="100">
            <app-statcard [data]="selected"></app-statcard>
        </div>
    </div>

    <div fxLayout="row wrap">
        <div fxFlex.gt-sm="25" fxFlex.gt-xs="100" fxFlex="100">
            <mat-card>
                <mat-card-content class="slimCard" style="min-height: 66px" fxLayoutAlign="center center">
                    <div id="icp-select" class="nexusselect"></div>
                    <button mat-icon-button color="warn" (click)="redrawCharts(icpSelect, 'ICPDimension')" matTooltip="Reset">
                        <mat-icon>indeterminate_check_box</mat-icon>
                    </button>
                </mat-card-content>
            </mat-card>
        </div>
        <div fxFlex.gt-sm="25" fxFlex.gt-xs="100" fxFlex="100">
            <mat-card>
                <mat-card-content class="slimCard" style="min-height: 66px" fxLayoutAlign="center center">
                    <div id="ccg-select" class="nexusselect"></div>
                    <button mat-icon-button color="warn" (click)="redrawCharts(ccgSelect, 'CCGDimension')" matTooltip="Reset">
                        <mat-icon>indeterminate_check_box</mat-icon>
                    </button>
                </mat-card-content>
            </mat-card>
        </div>
        <div fxFlex.gt-sm="25" fxFlex.gt-xs="100" fxFlex="100">
            <mat-card>
                <mat-card-content class="slimCard" style="min-height: 66px" fxLayoutAlign="center center">
                    <div id="neighbourhood-select" class="nexusselect"></div>
                    <button mat-icon-button color="warn" (click)="redrawCharts(neighbourhoodSelect, 'LDimension')" matTooltip="Reset">
                        <mat-icon>indeterminate_check_box</mat-icon>
                    </button>
                </mat-card-content>
            </mat-card>
        </div>
        <div fxFlex.gt-sm="25" fxFlex.gt-xs="100" fxFlex="100">
            <mat-card>
                <mat-card-content class="slimCard" fxLayoutAlign="space-around center">
                    <div fxLayoutAlign="center center" style="height: 66px">
                        <button type="button" mat-raised-button style="width: 100%" [class.bg-danger]="customBaseline">
                            <span
                                *ngIf="!customBaseline"
                                (click)="customBaseline = selectedPopulation; myDC.redrawAll(); gpChart.redraw(); ewChart.redraw()"
                                >Set Custom</span
                            >
                            <span
                                *ngIf="customBaseline"
                                (click)="customBaseline = null; myDC.redrawAll(); gpChart.redraw(); ewChart.redraw()"
                                >Clear Custom</span
                            >
                        </button>
                    </div>

                    <div class="forceColumn" fxLayoutAlign="center center" style="height: 66px">
                        <button type="button" mat-raised-button style="min-width: 50px" color="warn" (click)="resetToWholePop()">
                            <i class="fas fa-redo-alt"></i>
                        </button>
                        <mat-progress-bar *ngIf="resetBtnPushed" mode="indeterminate" style="margin-top: 10px"> </mat-progress-bar>
                    </div>
                </mat-card-content>
            </mat-card>
        </div>
    </div>

    <div fxLayout="row wrap">
        <div fxFlex.gt-sm="50" fxFlex.gt-xs="100" fxFlex="100" #ageholder>
            <mat-card>
                <mat-card-header>
                    <mat-card-title-group>
                        <mat-card-title style="padding-top: 2px"> Age Chart </mat-card-title>
                    </mat-card-title-group>
                    <div fxFlex></div>
                    <div fxLayoutAlign="center center">
                        <mat-chip-list *ngIf="queryFilter['AgeDimension']">
                            <mat-chip color="primary" selected>{{ queryFilter["AgeDimension"].toString().replace(",", " - ") }} </mat-chip>
                        </mat-chip-list>

                        <button
                            *ngIf="queryFilter && queryFilter['AgeDimension']"
                            mat-icon-button
                            color="warn"
                            (click)="redrawCharts(ageChart, 'AgeDimension')"
                            matTooltip="Reset"
                        >
                            <mat-icon>indeterminate_check_box</mat-icon>
                        </button>
                        <button *ngIf="showAgeFilterBtn" mat-stroked-button color="accent" (click)="applyBarChartFilter('ageChart')">
                            Apply Filter
                        </button>
                        <button mat-icon-button color="accent" (click)="onChartCollapse('ageChart')" title="Collapse">
                            <mat-icon>swap_vertical_circle</mat-icon>
                        </button>
                    </div>
                </mat-card-header>
                <mat-card-content #ageChartParent class="chartspace" [@expandCollapse]="ageChartOpenCloseAnim">
                    <div id="ageChart"></div>
                </mat-card-content>
            </mat-card>
        </div>
        <div fxFlex.gt-sm="35" fxFlex.gt-xs="100" fxFlex="100" #riskholder>
            <mat-card>
                <mat-card-header>
                    <mat-card-title-group>
                        <mat-card-title style="padding-top: 2px"> Risk Chart </mat-card-title>
                    </mat-card-title-group>
                    <div fxFlex></div>
                    <div fxLayoutAlign="center center">
                        <mat-chip-list *ngIf="queryFilter['RskDimension']">
                            <mat-chip color="primary" selected>{{ queryFilter["RskDimension"].toString().replace(",", " - ") }} </mat-chip>
                        </mat-chip-list>
                        <button
                            *ngIf="queryFilter && queryFilter['RskDimension']"
                            mat-icon-button
                            color="warn"
                            (click)="redrawCharts(riskChart, 'RskDimension')"
                            matTooltip="Reset"
                        >
                            <mat-icon>indeterminate_check_box</mat-icon>
                        </button>
                        <button *ngIf="showRiskFilterBtn" mat-stroked-button color="accent" (click)="applyBarChartFilter('riskChart')">
                            Apply Filter
                        </button>
                        <button mat-icon-button color="accent" (click)="onChartCollapse('riskChart')" title="Collapse">
                            <mat-icon>swap_vertical_circle</mat-icon>
                        </button>
                    </div>
                </mat-card-header>
                <mat-card-content #riskChartParent class="chartspace" [@expandCollapse]="riskChartOpenCloseAnim">
                    <div id="riskChart"></div>
                </mat-card-content>
            </mat-card>
        </div>
        <div fxFlex.gt-sm="15" fxFlex.gt-xs="100" fxFlex="100" #genderholder>
            <mat-card>
                <mat-card-header>
                    <mat-card-title-group>
                        <mat-card-title style="padding-top: 2px"> Gender </mat-card-title>
                    </mat-card-title-group>
                    <div fxFlex></div>
                    <div fxLayoutAlign="center center">
                        <button
                            *ngIf="queryFilter && queryFilter['SexDimension']"
                            mat-icon-button
                            color="warn"
                            (click)="redrawCharts(sexChart, 'SexDimension')"
                            matTooltip="Reset"
                        >
                            <mat-icon>indeterminate_check_box</mat-icon>
                        </button>
                        <button mat-icon-button color="accent" (click)="onChartCollapse('sexChart')" title="Collapse">
                            <mat-icon>swap_vertical_circle</mat-icon>
                        </button>
                    </div>
                </mat-card-header>
                <mat-card-content #sexChartParent class="chartspace noimage" [@expandCollapse]="sexChartOpenCloseAnim">
                    <div id="sexChart"></div>
                </mat-card-content>
            </mat-card>
        </div>
    </div>

    <div fxLayout="row wrap">
        <div fxFlex.gt-sm="100" fxFlex.gt-xs="100" fxFlex="100" #matrixholder>
            <mat-card (mouseleave)="exitMatrix()">
                <mat-card-header>
                    <mat-card-title-group>
                        <mat-card-title style="padding-top: 2px"> COVID Risk Matrix </mat-card-title>
                    </mat-card-title-group>
                    <div fxFlex></div>
                    <div fxLayoutAlign="center center">
                        <mat-chip-list *ngIf="queryFilter['MatrixDimension']">
                            <mat-chip
                                color="primary"
                                selected
                                (click)="showRange(queryFilter['MatrixDimension'].toString().split(',').join(' , '))"
                            >
                                {{ shortenText(queryFilter["MatrixDimension"].toString().split(",").join(" , ")) }}
                            </mat-chip>
                        </mat-chip-list>
                        <button
                            *ngIf="queryFilter && queryFilter['MatrixDimension']"
                            mat-icon-button
                            color="warn"
                            (click)="redrawCharts(matrixChart, 'MatrixDimension')"
                            matTooltip="Reset"
                        >
                            <mat-icon>indeterminate_check_box</mat-icon>
                        </button>
                        <button mat-icon-button color="accent" (click)="onChartCollapse('matrixChart')" title="Collapse">
                            <mat-icon>swap_vertical_circle</mat-icon>
                        </button>
                    </div>
                </mat-card-header>
                <mat-card-content #matrixChartParent class="chartspace" [@expandCollapse]="matrixChartOpenCloseAnim">
                    <div id="matrixChart"></div>
                </mat-card-content>
            </mat-card>
        </div>
    </div>

    <div fxLayout="row wrap">
        <div fxFlex.gt-sm="100" fxFlex.gt-xs="100" fxFlex="100" #mosaicholder>
            <mat-card (mouseleave)="exitMosaic()">
                <mat-card-header>
                    <mat-card-title-group>
                        <mat-card-title style="padding-top: 2px"> Mosaic Chart </mat-card-title>
                    </mat-card-title-group>
                    <div fxFlex></div>
                    <div fxLayoutAlign="center center">
                        <mat-chip-list *ngIf="queryFilter['MDimension']">
                            <mat-chip
                                color="primary"
                                selected
                                (click)="showRange(queryFilter['MDimension'].toString().split(',').join(' , '))"
                            >
                                {{ shortenText(queryFilter["MDimension"].toString().split(",").join(" , ")) }}
                            </mat-chip>
                        </mat-chip-list>
                        <button
                            *ngIf="queryFilter && queryFilter['MDimension']"
                            mat-icon-button
                            color="warn"
                            (click)="redrawCharts(mosaicChart, 'MDimension')"
                            matTooltip="Reset"
                        >
                            <mat-icon>indeterminate_check_box</mat-icon>
                        </button>
                        <button mat-icon-button color="accent" (click)="onChartCollapse('mosaicChart')" title="Collapse">
                            <mat-icon>swap_vertical_circle</mat-icon>
                        </button>
                    </div>
                </mat-card-header>
                <mat-card-content #mosaicChartParent class="chartspace" [@expandCollapse]="mosaicChartOpenCloseAnim">
                    <div id="mosaicChart"></div>
                </mat-card-content>
            </mat-card>
        </div>
    </div>

    <div fxLayout="row wrap">
        <div fxFlex.gt-sm="33" fxFlex.gt-xs="100" fxFlex="100" #ltcholder>
            <mat-card>
                <mat-card-header>
                    <mat-card-title-group>
                        <mat-card-title style="padding-top: 2px"> Long Term Conditions </mat-card-title>
                    </mat-card-title-group>
                    <div fxFlex></div>
                    <div fxLayoutAlign="center center">
                        <mat-chip-list *ngIf="queryFilter['LTCs2Dimension']">
                            <mat-chip
                                color="primary"
                                selected
                                (click)="showRange(queryFilter['LTCs2Dimension'].toString().split(',').join(' , '))"
                            >
                                {{ shortenText(queryFilter["LTCs2Dimension"].toString().split(",").join(" , ")) }}
                            </mat-chip>
                        </mat-chip-list>
                        <button
                            *ngIf="queryFilter && queryFilter['LTCs2Dimension']"
                            mat-icon-button
                            color="warn"
                            (click)="redrawCharts(ltcChart, 'LTCs2Dimension')"
                            matTooltip="Reset"
                        >
                            <mat-icon>indeterminate_check_box</mat-icon>
                        </button>
                        <button mat-icon-button color="accent" (click)="onChartCollapse('ltcChart')" title="Collapse">
                            <mat-icon>swap_vertical_circle</mat-icon>
                        </button>
                    </div>
                </mat-card-header>
                <mat-card-content #ltcChartParent [@expandCollapse]="ltcChartOpenCloseAnim" class="halfheight">
                    <div id="ltcChart" class="chartspace"></div>
                    <div id="no-selected-ltc-select" class="lctcountselect numLTCSelect" style="margin-right: 10px; margin-bottom: 10px">
                        <p>Number of selected LTCs</p>
                        <a
                            class="btn btn-sm btn-primary reset chart_reset"
                            onclick="redrawCharts(noSelectedLtcsSelect, 'numberSelLtc')"
                            style="display: none"
                            >Reset</a
                        >
                    </div>
                </mat-card-content>
            </mat-card>
        </div>
        <div fxFlex.gt-sm="34" fxFlex.gt-xs="100" fxFlex="100" #gppracticeholder>
            <mat-card>
                <mat-card-header>
                    <mat-card-title-group>
                        <mat-card-title style="padding-top: 2px"> GP Practice </mat-card-title>
                    </mat-card-title-group>
                    <div fxFlex></div>
                    <div fxLayoutAlign="center center">
                        <button
                            *ngIf="queryFilter && queryFilter['GPDimension']"
                            mat-icon-button
                            color="warn"
                            (click)="redrawCharts(gpChart, 'GPDimension')"
                            matTooltip="Reset"
                        >
                            <mat-icon>indeterminate_check_box</mat-icon>
                        </button>
                        <button mat-icon-button color="accent" (click)="onChartCollapse('gpChart')" title="Collapse">
                            <mat-icon>swap_vertical_circle</mat-icon>
                        </button>
                    </div>
                </mat-card-header>
                <mat-card-content #gpChartParent class="chartspace halfheight gp-chart" [@expandCollapse]="gpChartOpenCloseAnim">
                    <div *ngIf="gpLoading" fxLayoutAlign="center center"><mat-spinner></mat-spinner></div>
                    <div class="controls">
                        <mat-slide-toggle
                            [ngModel]="gpMapShowMarkers"
                            (change)="toggleGpMapChartType()"
                            [matTooltip]="gpMapShowMarkers ? 'Show circles' : 'Show markers'"
                        ></mat-slide-toggle>
                        <mat-slider
                            *ngIf="!gpMapShowMarkers"
                            min="100"
                            max="10000"
                            tickInterval="auto"
                            [value]="gpCircleScalingFactor"
                            (change)="gpSliderChanged($event)"
                            matTooltip="Change circle sizes"
                        ></mat-slider>
                    </div>
                    <div [style.visibility]="!gpMapShowMarkers ? 'visible' : 'hidden'" id="gpBubbleChart"></div>
                    <div [style.visibility]="gpMapShowMarkers ? 'visible' : 'hidden'" id="gpMarkerChart"></div>
                </mat-card-content>
            </mat-card>
        </div>
        <div fxFlex.gt-sm="33" fxFlex.gt-xs="100" fxFlex="100" #ewholder>
            <mat-card>
                <mat-card-header>
                    <mat-card-title-group>
                        <mat-card-title style="padding-top: 2px"> Electoral Ward </mat-card-title>
                    </mat-card-title-group>
                    <div fxFlex></div>
                    <div fxLayoutAlign="center center">
                        <button
                            *ngIf="queryFilter && queryFilter['WDimension']"
                            mat-icon-button
                            color="warn"
                            (click)="redrawCharts(ewChart, 'WDimension')"
                            matTooltip="Reset"
                        >
                            <mat-icon>indeterminate_check_box</mat-icon>
                        </button>
                        <button mat-icon-button color="accent" (click)="onChartCollapse('ewChart')" title="Collapse">
                            <mat-icon>swap_vertical_circle</mat-icon>
                        </button>
                    </div>
                </mat-card-header>
                <mat-card-content #ewChartParent class="chartspace halfheight" [@expandCollapse]="ewChartOpenCloseAnim">
                    <div *ngIf="ewLoading" fxLayoutAlign="center center"><mat-spinner></mat-spinner></div>
                    <div id="ewChart"></div>
                </mat-card-content>
            </mat-card>
        </div>
    </div>

    <div fxLayout="row wrap">
        <div fxFlex.gt-sm="33" fxFlex.gt-xs="100" fxFlex="100" #countltcholder>
            <mat-card>
                <mat-card-header>
                    <mat-card-title-group>
                        <mat-card-title style="padding-top: 2px"> Count of LTCs </mat-card-title>
                    </mat-card-title-group>
                    <div fxFlex></div>
                    <div fxLayoutAlign="center center">
                        <mat-chip-list *ngIf="queryFilter['LCntDimension']">
                            <mat-chip
                                color="primary"
                                selected
                                (click)="showRange(queryFilter['LCntDimension'].toString().split(',').join(' , '))"
                            >
                                {{ shortenText(queryFilter["LCntDimension"].toString().split(",").join(" , ")) }}
                            </mat-chip>
                        </mat-chip-list>
                        <button
                            *ngIf="queryFilter && queryFilter['LCntDimension']"
                            mat-icon-button
                            color="warn"
                            (click)="redrawCharts(countltcChart, 'LCntDimension')"
                            matTooltip="Reset"
                        >
                            <mat-icon>indeterminate_check_box</mat-icon>
                        </button>
                        <button mat-icon-button color="accent" (click)="onChartCollapse('countltcChart')" title="Collapse">
                            <mat-icon>swap_vertical_circle</mat-icon>
                        </button>
                    </div>
                </mat-card-header>
                <mat-card-content #countltcChartParent class="chartspace" [@expandCollapse]="countltcChartOpenCloseAnim">
                    <div id="countltcChart"></div>
                </mat-card-content>
            </mat-card>
        </div>
        <div fxFlex.gt-sm="34" fxFlex.gt-xs="100" fxFlex="100" #listholder>
            <mat-card>
                <mat-card-header>
                    <mat-card-title-group>
                        <mat-card-title style="padding-top: 2px"> Lists </mat-card-title>
                    </mat-card-title-group>
                    <div fxFlex></div>
                    <div fxLayoutAlign="center center">
                        <mat-chip-list *ngIf="queryFilter['Flags2Dimension']">
                            <mat-chip
                                color="primary"
                                selected
                                (click)="showRange(queryFilter['Flags2Dimension'].toString().split(',').join(' , '))"
                            >
                                {{ shortenText(queryFilter["Flags2Dimension"].toString().split(",").join(" , ")) }}
                            </mat-chip>
                        </mat-chip-list>
                        <button
                            *ngIf="queryFilter && queryFilter['Flags2Dimension']"
                            mat-icon-button
                            color="warn"
                            (click)="redrawCharts(flagChart, 'Flags2Dimension')"
                            matTooltip="Reset"
                        >
                            <mat-icon>indeterminate_check_box</mat-icon>
                        </button>
                        <button mat-icon-button color="accent" (click)="onChartCollapse('flagChart')" title="Collapse">
                            <mat-icon>swap_vertical_circle</mat-icon>
                        </button>
                    </div>
                </mat-card-header>
                <mat-card-content #flagChartParent class="chartspace" [@expandCollapse]="flagChartOpenCloseAnim">
                    <div id="flagChart"></div>
                    <div id="no-selected-flag-select" class="lctcountselect" style="margin-right: 10px; margin-bottom: 10px">
                        <p>Number of selected Lists</p>
                        <a
                            class="btn btn-sm btn-primary reset chart_reset"
                            onclick="redrawCharts(noSelectedFlagsSelect, 'numberSelFlag')"
                            style="display: none"
                            >Reset</a
                        >
                    </div>
                </mat-card-content>
            </mat-card>
        </div>
        <div fxFlex.gt-sm="33" fxFlex.gt-xs="100" fxFlex="100" #deprivationholder>
            <mat-card>
                <mat-card-header>
                    <mat-card-title-group>
                        <mat-card-title style="padding-top: 2px"> Deprivation Chart </mat-card-title>
                    </mat-card-title-group>
                    <div fxFlex></div>
                    <div fxLayoutAlign="center center">
                        <mat-chip-list *ngIf="queryFilter['DDimension']">
                            <mat-chip
                                color="primary"
                                selected
                                (click)="showRange(queryFilter['DDimension'].toString().split(',').join(' , '))"
                            >
                                {{ shortenText(queryFilter["DDimension"].toString().split(",").join(" , ")) }}
                            </mat-chip>
                        </mat-chip-list>
                        <button
                            *ngIf="queryFilter && queryFilter['DDimension']"
                            mat-icon-button
                            color="warn"
                            (click)="redrawCharts(deprivationChart, 'DDimension')"
                            matTooltip="Reset"
                        >
                            <mat-icon>indeterminate_check_box</mat-icon>
                        </button>
                        <button mat-icon-button color="accent" (click)="onChartCollapse('deprivationChart')" title="Collapse">
                            <mat-icon>swap_vertical_circle</mat-icon>
                        </button>
                    </div>
                </mat-card-header>
                <mat-card-content #deprivationChartParent class="chartspace" [@expandCollapse]="deprivationChartOpenCloseAnim">
                    <div id="deprivationChart"></div>
                </mat-card-content>
            </mat-card>
        </div>
    </div>

    <app-covid-cohort-all [cohort]="queryFilter" (changeEvent)="cohortChanged($event)"></app-covid-cohort-all>
</div>

<!-- Page loader -->
<div *ngIf="loading" class="loader">
    <div class="text">Retreiving data...</div>
    <div class="spinner"></div>
</div>
