<div *ngIf="dataLoaded === false" fxLayout="row wrap">
    <div fxFlex.gt-sm="100" fxFlex.gt-xs="100" fxFlex="100">
        <mat-card>
            <mat-spinner></mat-spinner>
        </mat-card>
    </div>
</div>

<div
    joyrideStep="phi0"
    stepPosition="center"
    title="Population Health"
    text="Population Health Intelligence provides an application for you to review your organisation's population and identify patient cohorts for providing targetted interventions for better health outcomes."
>
    <div
        fxLayout="row wrap"
        joyrideStep="phi1"
        title="Population Stats"
        text="Here you can find aggregated totals for your whole population, selected population and any custom population you have set."
    >
        <div fxFlex.gt-sm="25" fxFlex.gt-xs="100" fxFlex="100">
            <app-statcard [data]="icpPopulation"></app-statcard>
        </div>
        <div fxFlex.gt-sm="25" fxFlex.gt-xs="100" fxFlex="100">
            <app-statcard [data]="customPopulation"></app-statcard>
        </div>
        <div fxFlex.gt-sm="25" fxFlex.gt-xs="100" fxFlex="100">
            <app-statcard [data]="selectedPop"></app-statcard>
        </div>
        <div fxFlex.gt-sm="25" fxFlex.gt-xs="100" fxFlex="100">
            <app-statcard [data]="selected"></app-statcard>
        </div>
    </div>

    <div fxLayout="row wrap">
        <div fxFlex.gt-sm="25" fxFlex.gt-xs="100" fxFlex="100">
            <mat-card
                joyrideStep="phi2"
                title="Filter by CCG"
                text="The dropdown selection here will allow you to filter the selected population by the person's CCG."
            >
                <mat-card-content class="slimCard" style="min-height: 66px" fxLayoutAlign="center center">
                    <div id="ccg-select" class="nexusselect"></div>
                    <button mat-icon-button color="warn" (click)="redrawCharts(ccgSelect, 'CCGDimension')" title="Reset">
                        <mat-icon>indeterminate_check_box</mat-icon>
                    </button>
                </mat-card-content>
            </mat-card>
        </div>
        <div fxFlex.gt-sm="25" fxFlex.gt-xs="100" fxFlex="100">
            <mat-card
                joyrideStep="phi3"
                title="Filter by Neighbourhood"
                text="The dropdown selection here will allow you to filter the selected population by the person's Neighbourhood."
            >
                <mat-card-content class="slimCard" style="min-height: 66px" fxLayoutAlign="center center">
                    <div id="neighbourhood-select" class="nexusselect"></div>
                    <button mat-icon-button color="warn" (click)="redrawCharts(neighbourhoodSelect, 'LDimension')" title="Reset">
                        <mat-icon>indeterminate_check_box</mat-icon>
                    </button>
                </mat-card-content>
            </mat-card>
        </div>
        <div fxFlex.gt-sm="25" fxFlex.gt-xs="100" fxFlex="100">
            <mat-card
                joyrideStep="phi4"
                title="Custom Population"
                text="Using the button here, you can set the current selection as a Custom Population."
            >
                <mat-card-content class="slimCard">
                    <div fxLayoutAlign="center center" style="height: 66px">
                        <button type="button" mat-raised-button style="width: 100%" [class.bg-danger]="customBaseline">
                            <span
                                *ngIf="!customBaseline"
                                (click)="
                                    customBaseline = selectedPopulation;
                                    customcost = sumValues(filteredData['CstDimension'].values);
                                    myDC.redrawAll();
                                    gpChart.redraw();
                                    ewChart.redraw()
                                "
                                >Set Custom Baseline</span
                            >
                            <span
                                *ngIf="customBaseline"
                                (click)="customBaseline = null; customcost = '-'; myDC.redrawAll(); gpChart.redraw(); ewChart.redraw()"
                                >Clear Custom Baseline</span
                            >
                        </button>
                    </div>
                </mat-card-content>
            </mat-card>
        </div>
        <div fxFlex.gt-sm="25" fxFlex.gt-xs="100" fxFlex="100">
            <div fxLayout="row wrap">
                <div fxFlex.gt-sm="70" fxFlex.gt-xs="100" fxFlex="100">
                    <mat-card
                        joyrideStep="phi8"
                        title="Reset Current Selections"
                        text="You can clear any selections by pressing the Reset All button."
                    >
                        <mat-card-content class="slimCard">
                            <div class="forceColumn" fxLayoutAlign="center center" style="height: 66px">
                                <button type="button" mat-raised-button style="min-width: 100px" color="warn" (click)="resetToWholePop()">
                                    Reset All
                                </button>
                                <mat-progress-bar *ngIf="resetBtnPushed" mode="indeterminate" style="margin-top: 10px"> </mat-progress-bar>
                            </div>
                        </mat-card-content>
                    </mat-card>
                </div>

                <div fxFlex.gt-sm="30" fxFlex.gt-xs="100" fxFlex="100">
                    <mat-card>
                        <mat-card-content class="slimCard">
                            <div fxLayoutAlign="center center" style="height: 66px">
                                <button mat-icon-button color="primary" (click)="showGuide()" title="PHI Guide">
                                    <mat-icon>info</mat-icon>
                                </button>
                            </div>
                        </mat-card-content>
                    </mat-card>
                </div>
            </div>
        </div>
    </div>

    <div fxLayout="row wrap">
        <div fxFlex.gt-sm="50" fxFlex.gt-xs="100" fxFlex="100">
            <mat-card
                joyrideStep="phi5"
                title="Charts"
                text="Each of the data dimensions has an associated chart which displays data based on the current selection. You can filter these by selecting the appropriate region of the corresponding graph."
            >
                <mat-card-header>
                    <mat-card-title-group>
                        <mat-card-title style="padding-top: 2px"> Age Chart </mat-card-title>
                    </mat-card-title-group>
                    <div fxFlex></div>
                    <div fxLayoutAlign="center center">
                        <mat-progress-bar *ngIf="loadFilters['AgeDimension']" mode="indeterminate" style="width: 50px"> </mat-progress-bar
                        >&nbsp;
                        <mat-chip-list *ngIf="queryFilter['AgeDimension']">
                            <mat-chip color="primary" selected>{{ queryFilter["AgeDimension"].toString().replace(",", " - ") }} </mat-chip>
                        </mat-chip-list>
                        <button
                            *ngIf="queryFilter && queryFilter['AgeDimension']"
                            mat-icon-button
                            color="warn"
                            (click)="redrawCharts(ageChart, 'AgeDimension')"
                            title="Reset"
                        >
                            <mat-icon>indeterminate_check_box</mat-icon>
                        </button>
                        <button mat-icon-button color="accent" (click)="onChartCollapse('ageChart')" title="Collapse">
                            <mat-icon>swap_vertical_circle</mat-icon>
                        </button>
                    </div>
                </mat-card-header>
                <mat-card-content #ageChartParent class="chartspace" [@expandCollapse]="ageChartOpenCloseAnim">
                    <div id="ageChart"></div>
                </mat-card-content>
            </mat-card>
        </div>
        <div fxFlex.gt-sm="35" fxFlex.gt-xs="100" fxFlex="100">
            <mat-card>
                <mat-card-header>
                    <mat-card-title-group>
                        <mat-card-title style="padding-top: 2px"> Risk Chart </mat-card-title>
                    </mat-card-title-group>
                    <div fxFlex></div>
                    <div fxLayoutAlign="center center">
                        <mat-progress-bar *ngIf="loadFilters['RskDimension']" mode="indeterminate" style="width: 50px"> </mat-progress-bar
                        >&nbsp;
                        <mat-chip-list *ngIf="queryFilter['RskDimension']">
                            <mat-chip color="primary" selected>{{ queryFilter["RskDimension"].toString().replace(",", " - ") }} </mat-chip>
                        </mat-chip-list>
                        <button
                            *ngIf="queryFilter && queryFilter['RskDimension']"
                            mat-icon-button
                            color="warn"
                            (click)="redrawCharts(riskChart, 'RskDimension')"
                            title="Reset"
                        >
                            <mat-icon>indeterminate_check_box</mat-icon>
                        </button>
                        <button mat-icon-button color="accent" (click)="onChartCollapse('riskChart')" title="Collapse">
                            <mat-icon>swap_vertical_circle</mat-icon>
                        </button>
                    </div>
                </mat-card-header>
                <mat-card-content #riskChartParent class="chartspace" [@expandCollapse]="riskChartOpenCloseAnim">
                    <div id="riskChart"></div>
                </mat-card-content>
            </mat-card>
        </div>
        <div fxFlex.gt-sm="15" fxFlex.gt-xs="100" fxFlex="100">
            <mat-card>
                <mat-card-header>
                    <mat-card-title-group>
                        <mat-card-title style="padding-top: 2px"> Gender </mat-card-title>
                    </mat-card-title-group>
                    <div fxFlex></div>
                    <div fxLayoutAlign="center center">
                        <mat-progress-bar *ngIf="loadFilters['SexDimension']" mode="indeterminate" style="width: 50px"> </mat-progress-bar
                        >&nbsp;
                        <button
                            *ngIf="queryFilter && queryFilter['SexDimension']"
                            mat-icon-button
                            color="warn"
                            (click)="redrawCharts(sexChart, 'SexDimension')"
                            title="Reset"
                        >
                            <mat-icon>indeterminate_check_box</mat-icon>
                        </button>
                        <button mat-icon-button color="accent" (click)="onChartCollapse('sexChart')" title="Collapse">
                            <mat-icon>swap_vertical_circle</mat-icon>
                        </button>
                    </div>
                </mat-card-header>
                <mat-card-content #sexChartParent class="chartspace noimage" [@expandCollapse]="sexChartOpenCloseAnim">
                    <div id="sexChart"></div>
                </mat-card-content>
            </mat-card>
        </div>
    </div>

    <div fxLayout="row wrap">
        <div fxFlex.gt-sm="100" fxFlex.gt-xs="100" fxFlex="100">
            <mat-card (mouseleave)="exitMosaic()">
                <mat-card-header>
                    <mat-card-title-group>
                        <mat-card-title style="padding-top: 2px"> Mosaic Chart </mat-card-title>
                    </mat-card-title-group>
                    <div fxFlex></div>
                    <div fxLayoutAlign="center center">
                        <mat-progress-bar *ngIf="loadFilters['MDimension']" mode="indeterminate" style="width: 50px"> </mat-progress-bar
                        >&nbsp;
                        <mat-chip-list *ngIf="queryFilter['MDimension']">
                            <mat-chip
                                color="primary"
                                selected
                                (click)="showRange(queryFilter['MDimension'].toString().split(',').join(' , '))"
                            >
                                {{ shortenText(queryFilter["MDimension"].toString().split(",").join(" , ")) }}
                            </mat-chip>
                        </mat-chip-list>
                        <button
                            *ngIf="queryFilter && queryFilter['MDimension']"
                            mat-icon-button
                            color="warn"
                            (click)="redrawCharts(mosaicChart, 'MDimension')"
                            title="Reset"
                        >
                            <mat-icon>indeterminate_check_box</mat-icon>
                        </button>
                        <button mat-icon-button color="accent" (click)="onChartCollapse('mosaicChart')" title="Collapse">
                            <mat-icon>swap_vertical_circle</mat-icon>
                        </button>
                    </div>
                </mat-card-header>
                <mat-card-content #mosaicChartParent class="chartspace" [@expandCollapse]="mosaicChartOpenCloseAnim">
                    <div id="mosaicChart"></div>
                </mat-card-content>
            </mat-card>
        </div>
    </div>

    <div fxLayout="row wrap">
        <div fxFlex.gt-sm="33" fxFlex.gt-xs="100" fxFlex="100">
            <mat-card>
                <mat-card-header>
                    <mat-card-title-group>
                        <mat-card-title style="padding-top: 2px"> Long Term Conditions </mat-card-title>
                    </mat-card-title-group>
                    <div fxFlex></div>
                    <div fxLayoutAlign="center center">
                        <mat-progress-bar *ngIf="loadFilters['LTCs2Dimension']" mode="indeterminate" style="width: 50px"> </mat-progress-bar
                        >&nbsp;
                        <mat-chip-list *ngIf="queryFilter['LTCs2Dimension']">
                            <mat-chip
                                color="primary"
                                selected
                                (click)="showRange(queryFilter['LTCs2Dimension'].toString().split(',').join(' , '))"
                            >
                                {{ shortenText(queryFilter["LTCs2Dimension"].toString().split(",").join(" , ")) }}
                            </mat-chip>
                        </mat-chip-list>
                        <button
                            *ngIf="queryFilter && queryFilter['LTCs2Dimension']"
                            mat-icon-button
                            color="warn"
                            (click)="redrawCharts(ltcChart, 'LTCs2Dimension')"
                            title="Reset"
                        >
                            <mat-icon>indeterminate_check_box</mat-icon>
                        </button>
                        <button mat-icon-button color="accent" (click)="onChartCollapse('ltcChart')" title="Collapse">
                            <mat-icon>swap_vertical_circle</mat-icon>
                        </button>
                    </div>
                </mat-card-header>
                <mat-card-content #ltcChartParent class="halfheight" [@expandCollapse]="ltcChartOpenCloseAnim">
                    <div id="ltcChart" class="chartspace"></div>
                    <div id="no-selected-ltc-select" class="lctcountselect" style="margin-right: 10px; margin-bottom: 10px">
                        <p>Number of selected LTCs</p>
                        <a
                            class="btn btn-sm btn-primary reset chart_reset"
                            onclick="redrawCharts(noSelectedLtcsSelect, 'numberSelLtc')"
                            style="display: none"
                            >Reset</a
                        >
                    </div>
                </mat-card-content>
            </mat-card>
        </div>
        <div fxFlex.gt-sm="34" fxFlex.gt-xs="100" fxFlex="100">
            <mat-card>
                <mat-card-header>
                    <mat-card-title-group>
                        <mat-card-title style="padding-top: 2px"> GP Practice </mat-card-title>
                    </mat-card-title-group>
                    <div fxFlex></div>
                    <div fxLayoutAlign="center center">
                        <mat-progress-bar *ngIf="loadFilters['GPDimension']" mode="indeterminate" style="width: 50px"> </mat-progress-bar
                        >&nbsp;
                        <mat-slider
                            min="10"
                            max="1000"
                            tickInterval="auto"
                            [value]="gpCircleScalingFactor"
                            (change)="gpSliderChanged($event)"
                        ></mat-slider>
                        <button
                            *ngIf="queryFilter && queryFilter['GPDimension']"
                            mat-icon-button
                            color="warn"
                            (click)="redrawCharts(gpChart, 'GPDimension')"
                            title="Reset"
                        >
                            <mat-icon>indeterminate_check_box</mat-icon>
                        </button>
                        <button mat-icon-button color="accent" (click)="onChartCollapse('gpChart')" title="Collapse">
                            <mat-icon>swap_vertical_circle</mat-icon>
                        </button>
                    </div>
                </mat-card-header>
                <mat-card-content #gpChartParent class="chartspace halfheight" [@expandCollapse]="gpChartOpenCloseAnim">
                    <div *ngIf="gpTimer" style="width: 100%" fxLayoutAlign="center center"><mat-spinner></mat-spinner></div>
                    <div id="gpChart"></div>
                </mat-card-content>
            </mat-card>
        </div>
        <div fxFlex.gt-sm="33" fxFlex.gt-xs="100" fxFlex="100">
            <mat-card>
                <mat-card-header>
                    <mat-card-title-group>
                        <mat-card-title style="padding-top: 2px"> Electoral Ward </mat-card-title>
                    </mat-card-title-group>
                    <div fxFlex></div>
                    <div fxLayoutAlign="center center">
                        <mat-progress-bar *ngIf="loadFilters['WDimension']" mode="indeterminate" style="width: 50px"> </mat-progress-bar
                        >&nbsp;
                        <button
                            *ngIf="queryFilter && queryFilter['WDimension']"
                            mat-icon-button
                            color="warn"
                            (click)="redrawCharts(ewChart, 'WDimension')"
                            title="Reset"
                        >
                            <mat-icon>indeterminate_check_box</mat-icon>
                        </button>
                        <button mat-icon-button color="accent" (click)="onChartCollapse('ewChart')" title="Collapse">
                            <mat-icon>swap_vertical_circle</mat-icon>
                        </button>
                    </div>
                </mat-card-header>
                <mat-card-content #ewChartParent class="chartspace halfheight" [@expandCollapse]="ewChartOpenCloseAnim">
                    <div *ngIf="wardTimer" style="width: 100%" fxLayoutAlign="center center"><mat-spinner></mat-spinner></div>
                    <div id="ewChart"></div>
                </mat-card-content>
            </mat-card>
        </div>
    </div>

    <div fxLayout="row wrap">
        <div fxFlex.gt-sm="33" fxFlex.gt-xs="100" fxFlex="100">
            <mat-card>
                <mat-card-header>
                    <mat-card-title-group>
                        <mat-card-title style="padding-top: 2px"> Count of LTCs </mat-card-title>
                    </mat-card-title-group>
                    <div fxFlex></div>
                    <div fxLayoutAlign="center center">
                        <mat-progress-bar *ngIf="loadFilters['LCntDimension']" mode="indeterminate" style="width: 50px"> </mat-progress-bar
                        >&nbsp;
                        <mat-chip-list *ngIf="queryFilter['LCntDimension']">
                            <mat-chip
                                color="primary"
                                selected
                                (click)="showRange(queryFilter['LCntDimension'].toString().split(',').join(' , '))"
                            >
                                {{ shortenText(queryFilter["LCntDimension"].toString().split(",").join(" , ")) }}
                            </mat-chip>
                        </mat-chip-list>
                        <button
                            *ngIf="queryFilter && queryFilter['LCntDimension']"
                            mat-icon-button
                            color="warn"
                            (click)="redrawCharts(countltcChart, 'LCntDimension')"
                            title="Reset"
                        >
                            <mat-icon>indeterminate_check_box</mat-icon>
                        </button>
                        <button mat-icon-button color="accent" (click)="onChartCollapse('countltcChart')" title="Collapse">
                            <mat-icon>swap_vertical_circle</mat-icon>
                        </button>
                    </div>
                </mat-card-header>
                <mat-card-content #countltcChartParent class="chartspace" [@expandCollapse]="countltcChartOpenCloseAnim">
                    <div id="countltcChart"></div>
                </mat-card-content>
            </mat-card>
        </div>
        <div fxFlex.gt-sm="34" fxFlex.gt-xs="100" fxFlex="100">
            <mat-card>
                <mat-card-header>
                    <mat-card-title-group>
                        <mat-card-title style="padding-top: 2px"> Health Economy Burden Index </mat-card-title>
                    </mat-card-title-group>
                    <div fxFlex></div>
                    <div fxLayoutAlign="center center">
                        <mat-progress-bar *ngIf="loadFilters['UDimension']" mode="indeterminate" style="width: 50px"> </mat-progress-bar
                        >&nbsp;
                        <mat-chip-list *ngIf="queryFilter['UDimension']">
                            <mat-chip
                                color="primary"
                                selected
                                (click)="showRange(queryFilter['UDimension'].toString().split(',').join(' , '))"
                            >
                                {{ shortenText(queryFilter["UDimension"].toString().split(",").join(" , ")) }}
                            </mat-chip>
                        </mat-chip-list>
                        <button
                            *ngIf="queryFilter && queryFilter['UDimension']"
                            mat-icon-button
                            color="warn"
                            (click)="redrawCharts(costgroupChart, 'UDimension')"
                            title="Reset"
                        >
                            <mat-icon>indeterminate_check_box</mat-icon>
                        </button>
                        <button mat-icon-button color="accent" (click)="onChartCollapse('costgroupChart')" title="Collapse">
                            <mat-icon>swap_vertical_circle</mat-icon>
                        </button>
                    </div>
                </mat-card-header>
                <mat-card-content #costgroupChartParent class="chartspace" [@expandCollapse]="costgroupChartOpenCloseAnim">
                    <div id="costgroupChart"></div>
                </mat-card-content>
            </mat-card>
        </div>
        <div fxFlex.gt-sm="33" fxFlex.gt-xs="100" fxFlex="100">
            <mat-card>
                <mat-card-header>
                    <mat-card-title-group>
                        <mat-card-title style="padding-top: 2px"> Deprivation Chart </mat-card-title>
                    </mat-card-title-group>
                    <div fxFlex></div>
                    <div fxLayoutAlign="center center">
                        <mat-progress-bar *ngIf="loadFilters['DDimension']" mode="indeterminate" style="width: 50px"> </mat-progress-bar
                        >&nbsp;
                        <mat-chip-list *ngIf="queryFilter['DDimension']">
                            <mat-chip
                                color="primary"
                                selected
                                (click)="showRange(queryFilter['DDimension'].toString().split(',').join(' , '))"
                            >
                                {{ shortenText(queryFilter["DDimension"].toString().split(",").join(" , ")) }}
                            </mat-chip>
                        </mat-chip-list>
                        <button
                            *ngIf="queryFilter && queryFilter['DDimension']"
                            mat-icon-button
                            color="warn"
                            (click)="redrawCharts(deprivationChart, 'DDimension')"
                            title="Reset"
                        >
                            <mat-icon>indeterminate_check_box</mat-icon>
                        </button>
                        <button mat-icon-button color="accent" (click)="onChartCollapse('deprivationChart')" title="Collapse">
                            <mat-icon>swap_vertical_circle</mat-icon>
                        </button>
                    </div>
                </mat-card-header>
                <mat-card-content #deprivationChartParent class="chartspace" [@expandCollapse]="deprivationChartOpenCloseAnim">
                    <div id="deprivationChart"></div>
                </mat-card-content>
            </mat-card>
        </div>
    </div>

    <app-cohort-all [cohort]="queryFilter" (change)="cohortChanged($event)"></app-cohort-all>
</div>
